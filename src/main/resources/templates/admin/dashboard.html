<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments :: head('Панель администратора')"></head>
<body>
<div th:replace="fragments :: navbar"></div>
<div th:replace="fragments :: alert"></div>

<div class="container mt-4">
    <h2>Управление пользователями</h2>
    <div class="mt-3">
        <a href="/admin/statistics" class="btn btn-outline-primary">Статистика</a>
    </div>

    <table class="table table-striped">
        <thead>
        <tr>
            <th>
                <a th:href="@{/admin(sort='id', order=${sort == 'id' and order == 'asc' ? 'desc' : 'asc'})}">
                    ID
                </a>
            </th>
            <th>
                <a th:href="@{/admin(sort='email', order=${sort == 'email' and order == 'asc' ? 'desc' : 'asc'})}">
                    Email
                </a>
            </th>
            <th>
                <a th:href="@{/admin(sort='fullName', order=${sort == 'fullName' and order == 'asc' ? 'desc' : 'asc'})}">
                    ФИО
                </a>
            </th>
            <th>
                <a th:href="@{/admin(sort='role', order=${sort == 'role' and order == 'asc' ? 'desc' : 'asc'})}">
                    Роль
                </a>
            </th>
            <th>Действия</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="u : ${users}">
            <td th:text="${u.id}"></td>
            <td th:text="${u.email}"></td>
            <td th:text="${u.fullName}"></td>
            <td th:text="${u.role}"></td>
            <td>
                <form th:action="@{/admin/change-role/{id}(id=${u.id})}" method="post" class="d-inline">
                    <select name="role" class="form-select d-inline" style="width: auto;">
                        <option th:each="r : ${roles}" th:value="${r}" th:text="${r}" th:selected="${r == u.role}"></option>
                    </select>
                    <button type="submit" class="btn btn-sm btn-outline-primary">Сменить</button>
                </form>
                <a th:href="@{/admin/delete/{id}(id=${u.id})}"
                   class="btn btn-sm btn-outline-danger ms-2"
                   onclick="return confirm('Удалить пользователя?')">
                    Удалить
                </a>
            </td>
        </tr>
        </tbody>
    </table>

</div>

<div th:replace="fragments :: footer"></div>
</body>
</html>